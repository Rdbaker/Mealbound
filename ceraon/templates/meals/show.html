{% extends "layout.html" %}
{% block content %}
<div class="container">
  <div class="module col-sm-8">
    <h1>{{ meal.name }}</h1>
    <div class="container-narrow">
      <p>Description: <b>{{ meal.description }}</b></p>
      <p>When: <b>{{ meal.scheduled_for }}</b></p>
    </div>
    {% if current_user == meal.host %}
    <div class="container-narrow">
      <h3>Guests:</h3>
      <ul>
        {% for user_meal in meal.user_meals %}
          <li>{{ user_meal.user.public_name }}
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>

  <div class="module col-sm-3 col-sm-offset-1">
    {% if meal.joined(current_user) or meal.user_can_join(current_user) %}
      {% if meal.joined(current_user) %}
        <label>Cancel reservation</label>
        <div class="text-success">
          <p>You paid: <strong>{{ meal.price }}</strong></p>
        </div>
      {% else %}
        <label>Join this meal!</label>
        <div class="text-primary">
          <p>Price: <strong>{{ meal.price }}</strong></p>
        </div>
      {% endif %}
      <form action="{{ url_for('meal.join_or_leave_meal', uid=meal.id) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        {% if meal.joined(current_user) %}
          <input type="submit" class="btn btn-sm btn-danger" value="Cancel"/>
        {% else %}
          <input type="submit" class="btn btn-sm btn-info" value="Join"/>
        {% endif %}
      </form>
    {% else %}
      <p>Log in to join this meal!</p>
      <form id="loginForm" method="POST" class="navbar-form form-inline navbar-right" action="/?next={{ next_url }}" role="login">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-group">
          {{ login_form.email(placeholder="Email", class_="form-control") }}
          {{ login_form.password(placeholder="Password", class_="form-control") }}
        </div>
        <button type="submit" class="btn btn-default">Log in</button>
      </form>
      <p>Don't have an account yet? <a href="{{ url_for('public.register') }}">sign up!</a>
    {% endif %}
  </div>
  <div>
    {% if meal.is_host(current_user)  and meal.is_upcoming() %}
      <a href="{{ url_for('meal.edit', uid=meal.id) }}">Edit Meal</a>
      <form action="{{ url_for('meal.destroy', uid=meal.id) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <input type="submit" clas="btn btn-sm btn-danger" value="Cancel Meal"/>
      </form>
    {% endif %}
  </div>
{% endblock %}
